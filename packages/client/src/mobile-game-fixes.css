/* =================================================================
   MOBILE GAME VIEW FIXES - Portrait Mode Optimization
   ================================================================= */

/* Ensure full-screen game canvas on mobile - use dvh for iOS Safari toolbar */
#root {
  width: 100vw;
  height: 100vh;
  height: 100dvh; /* Dynamic viewport height for iOS Safari */
  overflow: hidden;
  position: fixed;
  inset: 0;
  margin: 0;
  padding: 0;
}

/* Game container should fill viewport */
.mobile-optimized {
  width: 100vw;
  height: 100vh;
  height: 100dvh; /* Dynamic viewport height for iOS Safari */
  position: fixed;
  inset: 0;
  overflow: hidden;
  margin: 0;
  padding: 0;
}

/* Screen wrapper for game view */
.screen.active {
  width: 100vw;
  height: 100vh;
  height: 100dvh; /* Dynamic viewport height for iOS Safari */
  position: absolute;
  inset: 0;
  margin: 0;
  padding: 0;
}

/* Game view specifically - ensure it fills entire screen */
.screen.active[style*="position: fixed"] {
  width: 100vw !important;
  height: 100vh !important;
  height: 100dvh !important;
  max-width: 100vw !important;
  max-height: 100vh !important;
  min-width: 100vw !important;
  min-height: 100vh !important;
}

/* Ensure canvas fills container - CRISP RENDERING */
canvas {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 100% !important;
  height: 100% !important;
  touch-action: none;
  user-select: none;
  -webkit-user-select: none;
  -webkit-tap-highlight-color: transparent;
  image-rendering: -webkit-optimize-contrast; /* Crisp rendering on Safari */
  image-rendering: crisp-edges; /* Crisp on other browsers */
  image-rendering: pixelated; /* Fallback */
  /* DO NOT use object-fit as it causes scaling blur */
}

/* Force PixiJS canvas to fill */
canvas[data-engine="three.js"],
canvas:not([id]) {
  object-fit: cover !important;
}

/* Game world container - ensure proper scaling */
.world-container,
.pixi-container {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  transform-origin: center center !important;
}

/* Mobile HUD Layout - Optimized positioning */
@media (max-width: 768px) and (orientation: portrait) {
  /* Hide leaderboard on mobile - too cluttered (both game and practice) */
  #leaderboard-container,
  .leaderboard-container,
  div[style*="leaderboard"],
  div[id*="leaderboard"] {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
  }

  /* Kill feed - Top left corner - OPTIMIZED NO GLITCH */
  #kill-feed-container,
  .kill-feed-container {
    top: calc(70px + env(safe-area-inset-top, 0px)) !important;
    left: 8px !important;
    width: 180px !important;
    font-size: 10px !important;
    max-height: calc(50vh - 250px) !important;
    overflow-y: auto;
    overflow-x: hidden;
    transform: none !important;
    background: rgba(0, 0, 0, 0.85) !important; /* Solid, no blur */
    border-radius: 8px !important;
    padding: 8px !important;
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6) !important;
    will-change: auto !important; /* Prevent GPU layer promotion */
    backface-visibility: hidden !important; /* Smoother rendering */
    -webkit-font-smoothing: antialiased !important;
    pointer-events: none !important; /* No interaction = no reflow */
  }
  

  
  /* Individual kill feed entries - ULTRA STABLE */
  #kill-feed-container > div,
  .kill-feed-container > div {
    padding: 4px 6px !important;
    margin-bottom: 3px !important;
    background: rgba(255, 255, 255, 0.08) !important;
    border-radius: 4px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    opacity: 1 !important;
    animation: none !important;
    transition: none !important;
    transform: translate3d(0, 0, 0) !important; /* Force GPU layer */
    will-change: auto !important;
    backface-visibility: hidden !important;
    pointer-events: none !important;
  }

  /* Hide desktop-only UI elements */
  #minimap-container,
  .minimap-container {
    display: none !important;
  }

  /* Compact radar on mobile - top center between boost bar and zone timer */
  #game-radar,
  .game-radar {
    width: 50px !important;
    height: 50px !important;
    top: calc(25px + env(safe-area-inset-top, 0px)) !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    bottom: auto !important;
    right: auto !important;
    border-radius: 25px !important;
    opacity: 0.8 !important;
    border: 2px solid rgba(0,255,255,0.4) !important;
    background: rgba(0, 0, 0, 0.6) !important;
    backdrop-filter: blur(4px) !important;
  }

  /* Boost bar - top center */
  #game-boost-bar,
  .game-boost-bar {
    bottom: auto !important;
    top: calc(10px + env(safe-area-inset-top, 0px)) !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 140px !important;
    height: 10px !important;
    border-radius: 5px !important;
    background: rgba(0, 0, 0, 0.6) !important;
    border: 1px solid rgba(0, 255, 255, 0.3) !important;
    overflow: hidden !important;
  }
  
  #game-boost-fill {
    height: 100% !important;
    border-radius: 4px !important;
    transition: width 0.2s ease !important;
  }
  
  #game-boost-label {
    display: none !important; /* Hide JUICE label on mobile */
  }

  /* Zone timer - position below boost bar and radar */
  #game-zone-timer,
  .game-zone-timer {
    top: calc(85px + env(safe-area-inset-top, 0px)) !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    font-size: 12px !important;
    font-weight: 700 !important;
    padding: 6px 12px !important;
    background: rgba(220, 38, 38, 0.9) !important;
    backdrop-filter: blur(8px) !important;
    border-radius: 12px !important;
    border: 2px solid rgba(255, 255, 255, 0.3) !important;
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.5) !important;
    color: #ffffff !important;
    letter-spacing: 0.5px !important;
  }

  /* Overview canvas - ensure it doesn't interfere */
  #game-overview-canvas,
  .game-overview-canvas {
    pointer-events: none !important;
    z-index: 12 !important;
  }

  /* Emote buttons - adjust for mobile, avoid boost */
  #emote-buttons,
  .emote-buttons {
    bottom: 200px !important;
    right: 10px !important;
  }

  #emote-buttons button,
  .emote-buttons button {
    width: 36px !important;
    height: 36px !important;
    font-size: 16px !important;
  }
}

/* Portrait-specific game layout */
@media (orientation: portrait) {
  /* Ensure no horizontal overflow */
  body, html {
    overflow-x: hidden;
    max-width: 100vw;
    position: fixed;
    width: 100%;
    height: 100%;
  }

  /* Game view container */
  .screen.active > div[style*="position: relative"],
  .screen.active > div[style*="position: fixed"] {
    width: 100vw !important;
    height: 100vh !important;
    height: 100dvh !important;
    max-width: 100vw !important;
    max-height: 100vh !important;
    min-width: 100vw !important;
    min-height: 100vh !important;
  }

  /* Prevent zoom on double-tap */
  * {
    touch-action: manipulation;
  }

  /* Compact HUD */
  .hud-element {
    transform: scale(0.85);
    transform-origin: top right;
  }

  /* Game UI container adjustments */
  .ui-container {
    pointer-events: none !important;
  }

  .ui-container > * {
    pointer-events: auto !important;
  }
}

/* Landscape warning should block interaction */
.orientation-warning {
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: all;
  touch-action: none;
}

/* Safe area insets for notched devices */
@supports (padding: env(safe-area-inset-bottom)) {
  .mobile-optimized {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  /* FORCE HIDE LEADERBOARD ON MOBILE */
  #leaderboard-container {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    width: 0 !important;
    height: 0 !important;
  }

  #kill-feed-container {
    top: calc(60px + env(safe-area-inset-top)) !important;
  }
}

/* Prevent iOS rubber band scrolling */
body {
  position: fixed;
  overflow: hidden;
  width: 100%;
  height: 100%;
  height: 100dvh;
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}

/* Additional mobile viewport fixes */
html {
  position: fixed;
  width: 100%;
  height: 100%;
  height: 100dvh;
  overflow: hidden;
}

/* Fix for practice lobby orbital animation - mobile responsive */
.orbit-center {
  width: 20px;
  height: 20px;
  background: radial-gradient(circle, rgba(34, 211, 238, 0.8), rgba(34, 211, 238, 0.3));
  border-radius: 50%;
  box-shadow: 0 0 20px rgba(34, 211, 238, 0.6);
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 5;
}

.orbit-ring {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  border: 2px dashed rgba(34, 211, 238, 0.3);
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  animation: rotate-orbit 20s linear infinite;
}

.orbit-sperm {
  position: absolute;
  width: 12px;
  height: 12px;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.9), rgba(34, 211, 238, 0.6));
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform-origin: 0 0;
  box-shadow: 0 0 10px rgba(34, 211, 238, 0.8);
  animation: pulse-sperm 2s ease-in-out infinite;
}

.orbit-sperm {
  --angle: calc((var(--i) / var(--n)) * 360deg);
  transform: 
    translate(-50%, -50%)
    rotate(var(--angle))
    translateX(100px)
    rotate(calc(-1 * var(--angle)));
}

/* Mobile responsive orbit */
@media (max-width: 768px) and (orientation: portrait) {
  .orbit-ring {
    width: 160px;
    height: 160px;
  }
  
  .orbit-sperm {
    --angle: calc((var(--i) / var(--n)) * 360deg);
    transform: 
      translate(-50%, -50%)
      rotate(var(--angle))
      translateX(80px)
      rotate(calc(-1 * var(--angle)));
  }
}

@keyframes rotate-orbit {
  from { transform: translate(-50%, -50%) rotate(0deg); }
  to { transform: translate(-50%, -50%) rotate(360deg); }
}

@keyframes pulse-sperm {
  0%, 100% { 
    transform: 
      translate(-50%, -50%)
      rotate(var(--angle))
      translateX(100px)
      rotate(calc(-1 * var(--angle)))
      scale(1);
  }
  50% { 
    transform: 
      translate(-50%, -50%)
      rotate(var(--angle))
      translateX(100px)
      rotate(calc(-1 * var(--angle)))
      scale(1.2);
  }
}

